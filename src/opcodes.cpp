#include <optional>
#include <unordered_map>

#include "opcodes.hpp"

const std::unordered_map<AddressMode, std::optional<int>> ARGUMENT_SIZES = {
    {AddressMode::Implied, 0},
    {AddressMode::ImmediateM, {}},
    {AddressMode::ImmediateX, {}},
    {AddressMode::Immediate8, 1},
    {AddressMode::Relative, 1},
    {AddressMode::RelativeLong, 2},
    {AddressMode::DirectPage, 1},
    {AddressMode::DirectPageIndexedX, 1},
    {AddressMode::DirectPageIndexedY, 1},
    {AddressMode::DirectPageIndirect, 1},
    {AddressMode::DirectPageIndexedIndirect, 1},
    {AddressMode::DirectPageIndirectIndexed, 1},
    {AddressMode::DirectPageIndirectLong, 1},
    {AddressMode::DirectPageIndirectIndexedLong, 1},
    {AddressMode::Absolute, 2},
    {AddressMode::AbsoluteIndexedX, 2},
    {AddressMode::AbsoluteIndexedY, 2},
    {AddressMode::AbsoluteLong, 3},
    {AddressMode::AbsoluteIndexedLong, 3},
    {AddressMode::StackRelative, 1},
    {AddressMode::StackRelativeIndirectIndexed, 1},
    {AddressMode::AbsoluteIndirect, 2},
    {AddressMode::AbsoluteIndirectLong, 2},
    {AddressMode::AbsoluteIndexedIndirect, 2},
    {AddressMode::ImpliedAccumulator, 0},
    {AddressMode::Move, 2},
    {AddressMode::StackAbsolute, 2},
    {AddressMode::PeiDirectPageIndirect, 1},
};

const std::pair<Opcode, AddressMode> OPCODE_TABLE[] = {
    {Opcode::BRK, AddressMode::Immediate8},
    {Opcode::ORA, AddressMode::DirectPageIndexedIndirect},
    {Opcode::COP, AddressMode::Immediate8},
    {Opcode::ORA, AddressMode::StackRelative},
    {Opcode::TSB, AddressMode::DirectPage},
    {Opcode::ORA, AddressMode::DirectPage},
    {Opcode::ASL, AddressMode::DirectPage},
    {Opcode::ORA, AddressMode::DirectPageIndirectLong},
    {Opcode::PHP, AddressMode::Implied},
    {Opcode::ORA, AddressMode::ImmediateM},
    {Opcode::ASL, AddressMode::ImpliedAccumulator},
    {Opcode::PHD, AddressMode::Implied},
    {Opcode::TSB, AddressMode::Absolute},
    {Opcode::ORA, AddressMode::Absolute},
    {Opcode::ASL, AddressMode::Absolute},
    {Opcode::ORA, AddressMode::AbsoluteLong},
    {Opcode::BPL, AddressMode::Relative},
    {Opcode::ORA, AddressMode::DirectPageIndirectIndexed},
    {Opcode::ORA, AddressMode::DirectPageIndirect},
    {Opcode::ORA, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::TRB, AddressMode::DirectPage},
    {Opcode::ORA, AddressMode::DirectPageIndexedX},
    {Opcode::ASL, AddressMode::DirectPageIndexedX},
    {Opcode::ORA, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::CLC, AddressMode::Implied},
    {Opcode::ORA, AddressMode::AbsoluteIndexedY},
    {Opcode::INC, AddressMode::ImpliedAccumulator},
    {Opcode::TCS, AddressMode::Implied},
    {Opcode::TRB, AddressMode::Absolute},
    {Opcode::ORA, AddressMode::AbsoluteIndexedX},
    {Opcode::ASL, AddressMode::AbsoluteIndexedX},
    {Opcode::ORA, AddressMode::AbsoluteIndexedLong},
    {Opcode::JSR, AddressMode::Absolute},
    {Opcode::AND, AddressMode::DirectPageIndexedIndirect},
    {Opcode::JSL, AddressMode::AbsoluteLong},
    {Opcode::AND, AddressMode::StackRelative},
    {Opcode::BIT, AddressMode::DirectPage},
    {Opcode::AND, AddressMode::DirectPage},
    {Opcode::ROL, AddressMode::DirectPage},
    {Opcode::AND, AddressMode::DirectPageIndirectLong},
    {Opcode::PLP, AddressMode::Implied},
    {Opcode::AND, AddressMode::ImmediateM},
    {Opcode::ROL, AddressMode::ImpliedAccumulator},
    {Opcode::PLD, AddressMode::Implied},
    {Opcode::BIT, AddressMode::Absolute},
    {Opcode::AND, AddressMode::Absolute},
    {Opcode::ROL, AddressMode::Absolute},
    {Opcode::AND, AddressMode::AbsoluteLong},
    {Opcode::BMI, AddressMode::Relative},
    {Opcode::AND, AddressMode::DirectPageIndirectIndexed},
    {Opcode::AND, AddressMode::DirectPageIndirect},
    {Opcode::AND, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::BIT, AddressMode::DirectPageIndexedX},
    {Opcode::AND, AddressMode::DirectPageIndexedX},
    {Opcode::ROL, AddressMode::DirectPageIndexedX},
    {Opcode::AND, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::SEC, AddressMode::Implied},
    {Opcode::AND, AddressMode::AbsoluteIndexedY},
    {Opcode::DEC, AddressMode::ImpliedAccumulator},
    {Opcode::TSC, AddressMode::Implied},
    {Opcode::BIT, AddressMode::AbsoluteIndexedX},
    {Opcode::AND, AddressMode::AbsoluteIndexedX},
    {Opcode::ROL, AddressMode::AbsoluteIndexedX},
    {Opcode::AND, AddressMode::AbsoluteIndexedLong},
    {Opcode::RTI, AddressMode::Implied},
    {Opcode::EOR, AddressMode::DirectPageIndexedIndirect},
    {Opcode::WDM, AddressMode::Immediate8},
    {Opcode::EOR, AddressMode::StackRelative},
    {Opcode::MVP, AddressMode::Move},
    {Opcode::EOR, AddressMode::DirectPage},
    {Opcode::LSR, AddressMode::DirectPage},
    {Opcode::EOR, AddressMode::DirectPageIndirectLong},
    {Opcode::PHA, AddressMode::Implied},
    {Opcode::EOR, AddressMode::ImmediateM},
    {Opcode::LSR, AddressMode::ImpliedAccumulator},
    {Opcode::PHK, AddressMode::Implied},
    {Opcode::JMP, AddressMode::Absolute},
    {Opcode::EOR, AddressMode::Absolute},
    {Opcode::LSR, AddressMode::Absolute},
    {Opcode::EOR, AddressMode::AbsoluteLong},
    {Opcode::BVC, AddressMode::Relative},
    {Opcode::EOR, AddressMode::DirectPageIndirectIndexed},
    {Opcode::EOR, AddressMode::DirectPageIndirect},
    {Opcode::EOR, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::MVN, AddressMode::Move},
    {Opcode::EOR, AddressMode::DirectPageIndexedX},
    {Opcode::LSR, AddressMode::DirectPageIndexedX},
    {Opcode::EOR, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::CLI, AddressMode::Implied},
    {Opcode::EOR, AddressMode::AbsoluteIndexedY},
    {Opcode::PHY, AddressMode::Implied},
    {Opcode::TCD, AddressMode::Implied},
    {Opcode::JML, AddressMode::AbsoluteLong},
    {Opcode::EOR, AddressMode::AbsoluteIndexedX},
    {Opcode::LSR, AddressMode::AbsoluteIndexedX},
    {Opcode::EOR, AddressMode::AbsoluteIndexedLong},
    {Opcode::RTS, AddressMode::Implied},
    {Opcode::ADC, AddressMode::DirectPageIndexedIndirect},
    {Opcode::PER, AddressMode::RelativeLong},
    {Opcode::ADC, AddressMode::StackRelative},
    {Opcode::STZ, AddressMode::DirectPage},
    {Opcode::ADC, AddressMode::DirectPage},
    {Opcode::ROR, AddressMode::DirectPage},
    {Opcode::ADC, AddressMode::DirectPageIndirectLong},
    {Opcode::PLA, AddressMode::Implied},
    {Opcode::ADC, AddressMode::ImmediateM},
    {Opcode::ROR, AddressMode::ImpliedAccumulator},
    {Opcode::RTL, AddressMode::Implied},
    {Opcode::JMP, AddressMode::AbsoluteIndirect},
    {Opcode::ADC, AddressMode::Absolute},
    {Opcode::ROR, AddressMode::Absolute},
    {Opcode::ADC, AddressMode::AbsoluteLong},
    {Opcode::BVS, AddressMode::Relative},
    {Opcode::ADC, AddressMode::DirectPageIndirectIndexed},
    {Opcode::ADC, AddressMode::DirectPageIndirect},
    {Opcode::ADC, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::STZ, AddressMode::DirectPageIndexedX},
    {Opcode::ADC, AddressMode::DirectPageIndexedX},
    {Opcode::ROR, AddressMode::DirectPageIndexedX},
    {Opcode::ADC, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::SEI, AddressMode::Implied},
    {Opcode::ADC, AddressMode::AbsoluteIndexedY},
    {Opcode::PLY, AddressMode::Implied},
    {Opcode::TDC, AddressMode::Implied},
    {Opcode::JMP, AddressMode::AbsoluteIndexedIndirect},
    {Opcode::ADC, AddressMode::AbsoluteIndexedX},
    {Opcode::ROR, AddressMode::AbsoluteIndexedX},
    {Opcode::ADC, AddressMode::AbsoluteIndexedLong},
    {Opcode::BRA, AddressMode::Relative},
    {Opcode::STA, AddressMode::DirectPageIndexedIndirect},
    {Opcode::BRL, AddressMode::RelativeLong},
    {Opcode::STA, AddressMode::StackRelative},
    {Opcode::STY, AddressMode::DirectPage},
    {Opcode::STA, AddressMode::DirectPage},
    {Opcode::STX, AddressMode::DirectPage},
    {Opcode::STA, AddressMode::DirectPageIndirectLong},
    {Opcode::DEY, AddressMode::Implied},
    {Opcode::BIT, AddressMode::ImmediateM},
    {Opcode::TXA, AddressMode::Implied},
    {Opcode::PHB, AddressMode::Implied},
    {Opcode::STY, AddressMode::Absolute},
    {Opcode::STA, AddressMode::Absolute},
    {Opcode::STX, AddressMode::Absolute},
    {Opcode::STA, AddressMode::AbsoluteLong},
    {Opcode::BCC, AddressMode::Relative},
    {Opcode::STA, AddressMode::DirectPageIndirectIndexed},
    {Opcode::STA, AddressMode::DirectPageIndirect},
    {Opcode::STA, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::STY, AddressMode::DirectPageIndexedX},
    {Opcode::STA, AddressMode::DirectPageIndexedX},
    {Opcode::STX, AddressMode::DirectPageIndexedY},
    {Opcode::STA, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::TYA, AddressMode::Implied},
    {Opcode::STA, AddressMode::AbsoluteIndexedY},
    {Opcode::TXS, AddressMode::Implied},
    {Opcode::TXY, AddressMode::Implied},
    {Opcode::STZ, AddressMode::Absolute},
    {Opcode::STA, AddressMode::AbsoluteIndexedX},
    {Opcode::STZ, AddressMode::AbsoluteIndexedX},
    {Opcode::STA, AddressMode::AbsoluteIndexedLong},
    {Opcode::LDY, AddressMode::ImmediateX},
    {Opcode::LDA, AddressMode::DirectPageIndexedIndirect},
    {Opcode::LDX, AddressMode::ImmediateX},
    {Opcode::LDA, AddressMode::StackRelative},
    {Opcode::LDY, AddressMode::DirectPage},
    {Opcode::LDA, AddressMode::DirectPage},
    {Opcode::LDX, AddressMode::DirectPage},
    {Opcode::LDA, AddressMode::DirectPageIndirectLong},
    {Opcode::TAY, AddressMode::Implied},
    {Opcode::LDA, AddressMode::ImmediateM},
    {Opcode::TAX, AddressMode::Implied},
    {Opcode::PLB, AddressMode::Implied},
    {Opcode::LDY, AddressMode::Absolute},
    {Opcode::LDA, AddressMode::Absolute},
    {Opcode::LDX, AddressMode::Absolute},
    {Opcode::LDA, AddressMode::AbsoluteLong},
    {Opcode::BCS, AddressMode::Relative},
    {Opcode::LDA, AddressMode::DirectPageIndirectIndexed},
    {Opcode::LDA, AddressMode::DirectPageIndirect},
    {Opcode::LDA, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::LDY, AddressMode::DirectPageIndexedX},
    {Opcode::LDA, AddressMode::DirectPageIndexedX},
    {Opcode::LDX, AddressMode::DirectPageIndexedY},
    {Opcode::LDA, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::CLV, AddressMode::Implied},
    {Opcode::LDA, AddressMode::AbsoluteIndexedY},
    {Opcode::TSX, AddressMode::Implied},
    {Opcode::TYX, AddressMode::Implied},
    {Opcode::LDY, AddressMode::AbsoluteIndexedX},
    {Opcode::LDA, AddressMode::AbsoluteIndexedX},
    {Opcode::LDX, AddressMode::AbsoluteIndexedY},
    {Opcode::LDA, AddressMode::AbsoluteIndexedLong},
    {Opcode::CPY, AddressMode::ImmediateX},
    {Opcode::CMP, AddressMode::DirectPageIndexedIndirect},
    {Opcode::REP, AddressMode::Immediate8},
    {Opcode::CMP, AddressMode::StackRelative},
    {Opcode::CPY, AddressMode::DirectPage},
    {Opcode::CMP, AddressMode::DirectPage},
    {Opcode::DEC, AddressMode::DirectPage},
    {Opcode::CMP, AddressMode::DirectPageIndirectLong},
    {Opcode::INY, AddressMode::Implied},
    {Opcode::CMP, AddressMode::ImmediateM},
    {Opcode::DEX, AddressMode::Implied},
    {Opcode::WAI, AddressMode::Implied},
    {Opcode::CPY, AddressMode::Absolute},
    {Opcode::CMP, AddressMode::Absolute},
    {Opcode::DEC, AddressMode::Absolute},
    {Opcode::CMP, AddressMode::AbsoluteLong},
    {Opcode::BNE, AddressMode::Relative},
    {Opcode::CMP, AddressMode::DirectPageIndirectIndexed},
    {Opcode::CMP, AddressMode::DirectPageIndirect},
    {Opcode::CMP, AddressMode::DirectPageIndirect},
    {Opcode::PEI, AddressMode::PeiDirectPageIndirect},
    {Opcode::CMP, AddressMode::DirectPageIndexedX},
    {Opcode::DEC, AddressMode::DirectPageIndexedX},
    {Opcode::CMP, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::CLD, AddressMode::Implied},
    {Opcode::CMP, AddressMode::AbsoluteIndexedY},
    {Opcode::PHX, AddressMode::Implied},
    {Opcode::STP, AddressMode::Implied},
    {Opcode::JML, AddressMode::AbsoluteIndirectLong},
    {Opcode::CMP, AddressMode::AbsoluteIndexedX},
    {Opcode::DEC, AddressMode::AbsoluteIndexedX},
    {Opcode::CMP, AddressMode::AbsoluteIndexedLong},
    {Opcode::CPX, AddressMode::ImmediateX},
    {Opcode::SBC, AddressMode::DirectPageIndexedIndirect},
    {Opcode::SEP, AddressMode::Immediate8},
    {Opcode::SBC, AddressMode::StackRelative},
    {Opcode::CPX, AddressMode::DirectPage},
    {Opcode::SBC, AddressMode::DirectPage},
    {Opcode::INC, AddressMode::DirectPage},
    {Opcode::SBC, AddressMode::DirectPageIndirectLong},
    {Opcode::INX, AddressMode::Implied},
    {Opcode::SBC, AddressMode::ImmediateM},
    {Opcode::NOP, AddressMode::Implied},
    {Opcode::XBA, AddressMode::Implied},
    {Opcode::CPX, AddressMode::Absolute},
    {Opcode::SBC, AddressMode::Absolute},
    {Opcode::INC, AddressMode::Absolute},
    {Opcode::SBC, AddressMode::AbsoluteLong},
    {Opcode::BEQ, AddressMode::Relative},
    {Opcode::SBC, AddressMode::DirectPageIndirectIndexed},
    {Opcode::SBC, AddressMode::DirectPageIndirect},
    {Opcode::SBC, AddressMode::StackRelativeIndirectIndexed},
    {Opcode::PEA, AddressMode::StackAbsolute},
    {Opcode::SBC, AddressMode::DirectPageIndexedX},
    {Opcode::INC, AddressMode::DirectPageIndexedX},
    {Opcode::SBC, AddressMode::DirectPageIndirectIndexedLong},
    {Opcode::SED, AddressMode::Implied},
    {Opcode::SBC, AddressMode::AbsoluteIndexedY},
    {Opcode::PLX, AddressMode::Implied},
    {Opcode::XCE, AddressMode::Implied},
    {Opcode::JSR, AddressMode::AbsoluteIndexedIndirect},
    {Opcode::SBC, AddressMode::AbsoluteIndexedX},
    {Opcode::INC, AddressMode::AbsoluteIndexedX},
    {Opcode::SBC, AddressMode::AbsoluteIndexedLong},
};
